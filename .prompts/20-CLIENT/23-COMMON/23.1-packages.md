# Client: Common Packages Structure

> **Deep Dive into `peers_touch_base` and `peers_touch_ui`**

---

## ðŸ§± peers_touch_base

**Purpose**: The brain of the client. Contains all business logic, data models, and infrastructure.

### Directory Structure (`client/common/peers_touch_base/lib/`)

| Directory | Purpose | Key Components |
|-----------|---------|----------------|
| **`model/domain/`** | **Single Source of Truth** | Generated Protobuf classes (`.pb.dart`). **NEVER EDIT MANUALLY.** |
| **`network/`** | **Connectivity** | `HttpService`, `Dio` interceptors, `LibP2P` integration. |
| **`ai_proxy/`** | **AI Logic** | OpenAI/Ollama adapters, prompt templates, token counting. |
| **`logger/`** | **Diagnostics** | `LoggingService` (standardized logging wrapper). |
| **`i18n/`** | **Localization** | Generated `AppLocalizations`. |
| **`context/`** | **App State** | `GlobalContext`, `AppLifecycle`. |

### Key Conventions

1. **Models**:
   - ALWAYS use classes from `model/domain`.
   - Extend functionality via **Extensions** (`extension ActorExt on Actor { ... }`), never inheritance.

2. **Networking**:
   - Use `HttpService` for REST calls.
   - Use `PeersTouchClient` for Station API interactions.

3. **AI Integration**:
   - Use `AiBoxService` as the entry point for AI features.
   - Implement new providers in `ai_proxy/provider`.

---

## ðŸŽ¨ peers_touch_ui

**Purpose**: The face of the client. A shared design system ensuring visual consistency.

### Directory Structure (`client/common/peers_touch_ui/lib/`)

| Directory | Purpose | Examples |
|-----------|---------|----------|
| **`src/widgets/`** | **Atomic Components** | `Button`, `Card`, `TextBox`, `Avatar`. |
| **`src/layout/`** | **Layout Patterns** | `BrandBar`, `IconSidebar`, `ThreePaneLayout`. |
| **`src/icons/`** | **Iconography** | `AiProviderIcons`, Custom SVG icons. |
| **`src/theme/`** | **Design Tokens** | Colors, Typography, Spacing definitions. |

### Component Rules

1. **Dumb Components**:
   - UI components should receive data via constructor.
   - They should emit events via callbacks (`onTap`, `onChanged`).
   - NO business logic or API calls inside widgets.

2. **Theming**:
   - Rely on `Theme.of(context)` or explicit style parameters.
   - Support both **Light** and **Dark** modes automatically.

3. **Responsiveness**:
   - Design components to adapt to available space.
   - Mobile and Desktop might use the same widget but with different constraints.

---

## ðŸ”„ Usage Example

### Importing in Client

```dart
// Correct Import
import 'package:peers_touch_base/peers_touch_base.dart';
import 'package:peers_touch_ui/peers_touch_ui.dart';

// Usage
class MyWidget extends StatelessWidget {
  final Actor actor; // From peers_touch_base

  Widget build(BuildContext context) {
    return PeersCard( // From peers_touch_ui
      child: Text(actor.displayName),
    );
  }
}
```
