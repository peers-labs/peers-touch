# 功能模块: AI 对话 (AI Chat)

## 1. 功能身份与核心目标 (Feature Identity & Core Goal)

本功能模块旨在打造一个强大的、对标业界领先产品（如 LobeChat）的桌面端AI对话体验。

**核心目标**: 提供一个集会话管理、多模态交互和模型配置于一体的、流畅且专业的聊天界面。所有与 `ai_chat` 功能相关的开发任务，都必须服务于此目标，并与 LobeChat 的交互哲学保持一致性。

## 2. 核心布局与组件 (Core Layout & Components)

AI对话界面由以下几个核心部分组成，形成一个经典的三栏式专业布局：

1.  **左侧边栏 (Session/Assistant Sidebar)**: 
    *   **职责**: 会话管理中心。用户可以在此搜索、创建、切换和管理所有的聊天会话。
    *   **关键元素**: 搜索框、新建对话按钮、会话列表。

2.  **中间主聊天区 (Main Chat Area)**:
    *   **职责**: 核心交互区域。展示消息时间线和提供内容输入。
    *   **关键元素**: 
        *   **顶部工具栏**: 显示当前会话标题、提供模型选择下拉框，并包含控制右侧面板显隐的开关。
        *   **消息列表**: 按照时间顺序展示用户与AI助手的对话气泡。
        *   **多模态输入框**: 位于底部的、功能强大的输入组件。

3.  **右侧面板 (Topic/Settings Panel)**:
    *   **职责**: 提供上下文相关的辅助功能，如聊天主题管理或特定于会话的设置。
    *   **关键元素**: 主题列表、设置项。

### 关键组件: 多模态输入框 (Multi-modal Input Box)

这是 `ai_chat` 功能的核心交互组件，必须具备高度的灵活性和强大的功能性。

*   **核心能力**: 支持 **文本、图片、文件、语音、截图** 等多种输入方式的混合编辑与发送。
*   **交互要求**: 支持拖拽、粘贴、录音等多种快捷操作，并能在不同宽度下自适应布局，避免UI溢出。
*   **数据结构**: 输入框内的内容（草稿）应被建模为包含文本和附件列表的统一结构 (`AiComposerDraft`)，以便序列化为符合OpenAI协议的消息格式。

## 3. 关键用户故事 (Key User Stories)

*   **作为用户**: 我可以进入设置，配置一个OpenAI兼容的Provider（提供`baseUrl`和`apiKey`），以便系统能动态拉取可用的模型列表。
*   **作为用户**: 我可以在左侧边栏创建新的聊天会话，或在已有的会话之间自由切换。
*   **作为用户**: 我可以在中间聊天区的输入框中输入文本，选择一个模型，然后发送消息并看到AI的回复。
*   **作为用户**: 我可以通过粘贴、拖拽或文件选择器，将图片或文件添加到我的消息中，并与文本一起发送。
*   **作为用户**: 我可以打开或关闭右侧的主题面板，来管理我的聊天主题。

## 4. 架构蓝图 (Architectural Blueprint)

*   **状态与逻辑**: 本功能的核心业务逻辑和状态由 `AIChatController` 统一管理。输入框的复杂交互则由其专属的 `AiInputController` 负责。
*   **数据服务**: 与AI后端的交互（如模型拉取、消息发送）通过抽象的 `AIService` 及其实现（如 `OpenAIService`）来完成。
*   **数据模型**: 
    *   `ChatSession`: 定义一个独立的聊天会话。
    *   `ChatMessage`: 定义单条消息（包含角色、内容等）。
    *   `AiComposerDraft` & `AiAttachment`: 专门用于描述多模态输入框内的草稿内容和附件。

在执行任何与 `ai_chat` 相关的任务时，你都应首先回顾此蓝图，确保你的实现符合既定的组件职责和数据流向。
