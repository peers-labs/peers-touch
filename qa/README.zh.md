# è´¨é‡ä¿è¯æ–¹æ¡ˆ

> **Peers-Touch é¡¹ç›®çš„å®Œæ•´è´¨é‡ä¿è¯ä½“ç³»**

## ğŸ“š æ–‡æ¡£å¯¼èˆª

- **[å¿«é€Ÿå…¥é—¨](QUICKSTART.zh.md)** - 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
- **[ç›®å½•ç»“æ„](STRUCTURE.zh.md)** - ç›®å½•ç»„ç»‡è¯´æ˜
- **[Station æµ‹è¯•](station/api_tests/README.md)** - åç«¯ API æµ‹è¯•
- **[Client æµ‹è¯•](client/README.md)** - å‰ç«¯æµ‹è¯•

---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

è§£å†³ä¸¤ä¸ªå…³é”®ç—›ç‚¹ï¼š
1. **æ¯æ¬¡æ”¹åŠ¨æ— æ³•ç¡®è®¤å½±å“é¢** - ç¼ºå°‘æ”¹åŠ¨è¯„ä»·ä½“ç³»
2. **åŠŸèƒ½ç»å¸¸å¤±æ•ˆ** - AI æ”¹ä»£ç æ—¶ä¸å…³æ³¨è¿‡å¾€åŠŸèƒ½

---

## ğŸ“‹ æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯• - ä¿è¯ä»£ç ç¨³å®š

**ç›®çš„**: æµ‹è¯•æ¯ä¸ªå‡½æ•°/æ–¹æ³•çš„é€»è¾‘æ­£ç¡®æ€§

**è¦†ç›–èŒƒå›´**:
- Service å±‚ä¸šåŠ¡é€»è¾‘ï¼ˆCRUD æ“ä½œï¼‰
- æ•°æ®éªŒè¯å’Œè½¬æ¢
- é”™è¯¯å¤„ç†
- è¾¹ç•Œæ¡ä»¶

**ä½ç½®**:
- Go: `station/app/subserver/*/service/*_test.go`
- Dart: `client/common/peers_touch_base/test/service/*_test.dart`

**è¿è¡Œç¯å¢ƒ**:
- æœ¬åœ°å¼€å‘ç¯å¢ƒï¼šå¿«é€Ÿåé¦ˆ
- Docker ç¯å¢ƒï¼šå®Œæ•´éš”ç¦»æµ‹è¯•

**è¦†ç›–ç‡ç›®æ ‡**: 80%+

### 2. API æµ‹è¯• - ä¿è¯æ¥å£ç¨³å®š

**ç›®çš„**: éªŒè¯å‰åç«¯æ¥å£çš„è¾“å…¥è¾“å‡ºä¸€è‡´æ€§

**è¦†ç›–èŒƒå›´**:
- è¯·æ±‚/å“åº”æ ¼å¼
- çŠ¶æ€ç 
- æ•°æ®å®Œæ•´æ€§
- é”™è¯¯å¤„ç†
- æ‰€æœ‰æ¨¡å—çš„ CRUD æ“ä½œ

**ä½ç½®**: `qa/station_api/`

**æµ‹è¯•æ–¹å¼**:
- è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆbash + curlï¼‰
- æ¯ä¸ª API ç‹¬ç«‹æµ‹è¯•æ–‡ä»¶
- é›†æˆæµ‹è¯•ç¼–æ’æ‰€æœ‰ API

**æµ‹è¯•ç¯å¢ƒ**:
- **Docker ç¯å¢ƒï¼ˆæ¨èï¼‰**: ä½¿ç”¨é¢„ç½®æµ‹è¯•æ•°æ®ï¼Œå®Œå…¨éš”ç¦»
- **æœ¬åœ°ç¯å¢ƒ**: éœ€è¦æ‰‹åŠ¨å‡†å¤‡æ•°æ®ï¼Œå¯èƒ½å½±å“å¼€å‘æ•°æ®

---

## ğŸ§ª æµ‹è¯•åŸåˆ™

### ç‹¬ç«‹æ€§

**è¦æ±‚**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–å…¶ä»–ç”¨ä¾‹

**å®ç°**:
```go
// âœ… æ­£ç¡®ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹åˆ›å»ºæ•°æ®
func TestCreateProvider(t *testing.T) {
    provider := createTestProvider()  // ç‹¬ç«‹åˆ›å»º
    // æµ‹è¯•é€»è¾‘
    cleanupTestProvider(provider.Id)  // ç‹¬ç«‹æ¸…ç†
}

// âŒ é”™è¯¯ï¼šä¾èµ–å…¨å±€çŠ¶æ€
var globalProvider *Provider
func TestUpdateProvider(t *testing.T) {
    globalProvider.Name = "New Name"  // ä¾èµ–å…¨å±€çŠ¶æ€
}
```

### è”åˆæ€§

**è¦æ±‚**: ä¿éšœæ•´ä½“ç³»ç»Ÿçš„åŠŸèƒ½è”åŠ¨å®Œæ•´

**å®ç°**:
- ç«¯åˆ°ç«¯æµ‹è¯•å…³é”®ä¸šåŠ¡æµç¨‹
- æµ‹è¯•æ¨¡å—é—´çš„é›†æˆç‚¹
- éªŒè¯æ•°æ®æµè½¬æ­£ç¡®æ€§

**ç¤ºä¾‹æµç¨‹**:
```
åˆ›å»º Provider â†’ ä¸Šä¼ æ–‡ä»¶ â†’ ä½¿ç”¨ Provider å¤„ç† â†’ éªŒè¯ç»“æœ
```

---

## ğŸ“ æµ‹è¯•ç»“æ„

```
qa/
â”œâ”€â”€ README.zh.md                  # æœ¬æ–‡æ¡£ï¼ˆæ•´ä½“è´¨é‡ä¿è¯æ–¹æ¡ˆï¼‰
â”œâ”€â”€ station/                      # Stationï¼ˆåç«¯ï¼‰æµ‹è¯•
â”‚   â”œâ”€â”€ docker-compose.test.yml   # Docker æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ run_docker_tests.sh       # Docker æµ‹è¯•è¿è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ api_tests/                # API æµ‹è¯•è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ health_test.sh        # å¥åº·æ£€æŸ¥æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ provider_test.sh      # Provider API æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ oss_test.sh           # OSS API æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ integration_test.sh   # é›†æˆæµ‹è¯•ç¼–æ’
â”‚   â”‚   â””â”€â”€ README.md             # API æµ‹è¯•æ–‡æ¡£
â”‚   â””â”€â”€ test_data/                # æµ‹è¯•æ•°æ®
â”‚       â”œâ”€â”€ README.md             # æµ‹è¯•æ•°æ®è¯´æ˜
â”‚       â”œâ”€â”€ init.sql              # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚       â”œâ”€â”€ providers.json        # Provider æµ‹è¯•æ•°æ®
â”‚       â””â”€â”€ test_files/           # æµ‹è¯•æ–‡ä»¶
â”‚           â”œâ”€â”€ sample.txt
â”‚           â””â”€â”€ sample.json
â””â”€â”€ client/                       # Clientï¼ˆå‰ç«¯ï¼‰æµ‹è¯•
    â”œâ”€â”€ README.md                 # å®¢æˆ·ç«¯æµ‹è¯•è¯´æ˜
    â”œâ”€â”€ desktop/                  # Desktop æµ‹è¯•ï¼ˆå¾…å®Œå–„ï¼‰
    â””â”€â”€ mobile/                   # Mobile æµ‹è¯•ï¼ˆå¾…å®Œå–„ï¼‰
```

---

## ğŸš€ è¿è¡Œæµ‹è¯•

### æ–¹å¼ä¸€ï¼šDocker éš”ç¦»ç¯å¢ƒæµ‹è¯•ï¼ˆæ¨èï¼‰

**ä¼˜åŠ¿**:
- âœ… å®Œå…¨éš”ç¦»çš„æµ‹è¯•ç¯å¢ƒ
- âœ… é¢„ç½®æµ‹è¯•æ•°æ®ï¼Œä¸å½±å“ç”Ÿäº§ç¯å¢ƒ
- âœ… è‡ªåŠ¨ç®¡ç†ä¾èµ–ï¼ˆPostgreSQL, Redisï¼‰
- âœ… å¯é‡å¤æ‰§è¡Œï¼Œç¯å¢ƒä¸€è‡´

```bash
# å¿«æ·å‘½ä»¤ï¼ˆæ¨èï¼‰
make test                    # è¿è¡Œå®Œæ•´ Docker æµ‹è¯•
make test-docker-logs        # è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºæ—¥å¿—
make test-docker-keep        # è¿è¡Œæµ‹è¯•å¹¶ä¿æŒå®¹å™¨ï¼ˆè°ƒè¯•ç”¨ï¼‰
make clean-test              # æ¸…ç†æµ‹è¯•ç¯å¢ƒ

# æˆ–ç›´æ¥è¿è¡Œè„šæœ¬
bash qa/run_docker_tests.sh
bash qa/run_docker_tests.sh --logs
bash qa/run_docker_tests.sh --keep
```

**æµ‹è¯•æµç¨‹**:
1. ğŸ³ å¯åŠ¨ PostgreSQLã€Redisã€Station å®¹å™¨
2. ğŸ“Š åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“å’Œé¢„ç½®æ•°æ®
3. â³ ç­‰å¾…æ‰€æœ‰æœåŠ¡å°±ç»ª
4. ğŸ§ª è¿è¡Œæ‰€æœ‰ API æµ‹è¯•
5. ğŸ§¹ è‡ªåŠ¨æ¸…ç†å®¹å™¨å’Œæ•°æ®

**æ•°æ®éš”ç¦»**:
- æµ‹è¯•æ•°æ®åº“: `peers_touch_test` (ç«¯å£ 5433)
- æµ‹è¯• Redis: ç«¯å£ 6380
- æµ‹è¯•æœåŠ¡: http://localhost:18080
- é¢„ç½®æµ‹è¯•æ•°æ®ï¼ˆè§ `qa/test_data/init.sql`ï¼‰

### æ–¹å¼äºŒï¼šæœ¬åœ°ç¯å¢ƒæµ‹è¯•

```bash
# 1. å•å…ƒæµ‹è¯•
make test-unit

# 2. API æµ‹è¯•ï¼ˆéœ€è¦å…ˆå¯åŠ¨æœåŠ¡ï¼‰
# ç»ˆç«¯ 1: å¯åŠ¨æœåŠ¡
cd station/app
go run main.go

# ç»ˆç«¯ 2: è¿è¡Œ API æµ‹è¯•
make test-api
# æˆ–: bash qa/station/api_tests/integration_test.sh

# 3. æŸ¥çœ‹è¦†ç›–ç‡
make test-coverage
```

### å¿«æ·å‘½ä»¤æ±‡æ€»

| å‘½ä»¤ | è¯´æ˜ | ç¯å¢ƒ |
|------|------|------|
| `make test` | è¿è¡Œå®Œæ•´ Docker æµ‹è¯•ï¼ˆé»˜è®¤ï¼‰ | Docker |
| `make test-docker` | è¿è¡Œ Docker æµ‹è¯• | Docker |
| `make test-docker-logs` | è¿è¡Œ Docker æµ‹è¯•å¹¶æ˜¾ç¤ºæ—¥å¿— | Docker |
| `make test-docker-keep` | è¿è¡Œ Docker æµ‹è¯•å¹¶ä¿æŒå®¹å™¨ | Docker |
| `make test-unit` | è¿è¡Œå•å…ƒæµ‹è¯• | æœ¬åœ° |
| `make test-api` | è¿è¡Œ API æµ‹è¯• | æœ¬åœ° |
| `make test-coverage` | ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š | æœ¬åœ° |
| `make clean-test` | æ¸…ç†æµ‹è¯•ç¯å¢ƒ | Docker |

---

## ğŸ³ Docker æµ‹è¯•ç¯å¢ƒ

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker Network                        â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚    Redis     â”‚  â”‚   Station    â”‚ â”‚
â”‚  â”‚   æµ‹è¯•æ•°æ®åº“  â”‚  â”‚   æµ‹è¯•ç¼“å­˜    â”‚  â”‚   æµ‹è¯•æœåŠ¡    â”‚ â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚ â”‚
â”‚  â”‚  Port: 5433  â”‚  â”‚  Port: 6380  â”‚  â”‚ Port: 18080  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â–²                 â–²                  â–²          â”‚
â”‚         â”‚                 â”‚                  â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                      é¢„ç½®æµ‹è¯•æ•°æ®                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–²
                           â”‚
                    API æµ‹è¯•è„šæœ¬
                  (qa/station_api/*.sh)
```

### æ ¸å¿ƒä¼˜åŠ¿

1. **å®Œå…¨éš”ç¦»**
   - ç‹¬ç«‹çš„æ•°æ®åº“å®ä¾‹ï¼ˆä¸å½±å“å¼€å‘ç¯å¢ƒï¼‰
   - ç‹¬ç«‹çš„ Redis å®ä¾‹
   - ç‹¬ç«‹çš„ç½‘ç»œç¯å¢ƒ

2. **é¢„ç½®æ•°æ®**
   - æ•°æ®åº“è‡ªåŠ¨åˆå§‹åŒ–ï¼ˆ`init.sql`ï¼‰
   - é¢„ç½® 3 ä¸ªæµ‹è¯• Provider
   - é¢„ç½® 2 ä¸ªæµ‹è¯•æ–‡ä»¶è®°å½•
   - æ‰€æœ‰æ¨¡å—çš„æµ‹è¯•æ•°æ®éƒ½å¯é¢„ç½®

3. **å¯é‡å¤æ€§**
   - æ¯æ¬¡è¿è¡Œéƒ½æ˜¯å…¨æ–°ç¯å¢ƒ
   - æµ‹è¯•ç»“æœä¸€è‡´å¯é 
   - è‡ªåŠ¨æ¸…ç†ï¼Œä¸ç•™åƒåœ¾æ•°æ®

4. **æ˜“äºç»´æŠ¤**
   - ä¿®æ”¹ `init.sql` æ·»åŠ æ–°æµ‹è¯•æ•°æ®
   - ä¿®æ”¹ `docker-compose.test.yml` è°ƒæ•´é…ç½®
   - ä¸€é”®å¯åŠ¨ï¼Œä¸€é”®æ¸…ç†

### ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èæ–¹å¼ | åŸå›  |
|------|---------|------|
| å¼€å‘ä¸­å¿«é€Ÿæµ‹è¯•å•ä¸ªåŠŸèƒ½ | æœ¬åœ°ç¯å¢ƒ | å¯åŠ¨å¿«ï¼Œåé¦ˆå¿« |
| æäº¤å‰å®Œæ•´æµ‹è¯• | Docker ç¯å¢ƒ | å®Œæ•´è¦†ç›–ï¼Œæ•°æ®éš”ç¦» |
| CI/CD è‡ªåŠ¨åŒ–æµ‹è¯• | Docker ç¯å¢ƒ | ç¯å¢ƒä¸€è‡´ï¼Œå¯é‡å¤ |
| æµ‹è¯•æ•°æ®åº“è¿ç§» | Docker ç¯å¢ƒ | å®‰å…¨ï¼Œå¯å›æ»š |
| æ–°äººç¯å¢ƒæ­å»º | Docker ç¯å¢ƒ | ä¸€é”®å¯åŠ¨ï¼Œæ— éœ€é…ç½® |

### é¢„ç½®æµ‹è¯•æ•°æ®

#### Providers

| ID | Name | Type | Active | ç”¨é€” |
|----|------|------|--------|------|
| `11111111-...` | Test Provider 1 | openai | âœ… | æµ‹è¯•æ­£å¸¸ CRUD |
| `22222222-...` | Test Provider 2 | anthropic | âœ… | æµ‹è¯•å¤šæ¡è®°å½• |
| `33333333-...` | Inactive Provider | custom | âŒ | æµ‹è¯•çŠ¶æ€è¿‡æ»¤ |

#### OSS Files

| ID | File Key | Size | ç”¨é€” |
|----|----------|------|------|
| `aaaaaaaa-...` | test/file1.txt | 1KB | æµ‹è¯•æ–‡æœ¬æ–‡ä»¶ |
| `bbbbbbbb-...` | test/image.png | 2KB | æµ‹è¯•å›¾ç‰‡æ–‡ä»¶ |

### æ·»åŠ æ–°æ¨¡å—æµ‹è¯•æ•°æ®

å½“æ·»åŠ æ–°æ¨¡å—æ—¶ï¼Œåœ¨ `qa/station/test_data/init.sql` ä¸­æ·»åŠ ï¼š

```sql
-- æ–°æ¨¡å—è¡¨ç»“æ„
CREATE TABLE IF NOT EXISTS your_module (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- é¢„ç½®æµ‹è¯•æ•°æ®
INSERT INTO your_module (id, name) VALUES
    ('test-id-1', 'Test Data 1'),
    ('test-id-2', 'Test Data 2');
```

ç„¶ååœ¨ `qa/station/api_tests/` åˆ›å»ºå¯¹åº”çš„æµ‹è¯•è„šæœ¬ï¼š

```bash
# qa/station/api_tests/your_module_test.sh
#!/bin/bash
# æµ‹è¯•ä½ çš„æ¨¡å— CRUD æ“ä½œ
```

### è°ƒè¯•æŠ€å·§

```bash
# 1. ä¿æŒå®¹å™¨è¿è¡Œ
bash qa/station/run_docker_tests.sh --keep

# 2. æŸ¥çœ‹å®¹å™¨çŠ¶æ€
cd qa/station
docker-compose -f docker-compose.test.yml ps

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.test.yml logs station-test
docker-compose -f docker-compose.test.yml logs postgres-test

# 4. è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it peers-touch-test-station sh
docker exec -it peers-touch-test-db psql -U test_user -d peers_touch_test

# 5. æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
docker exec -it peers-touch-test-station ./station

# 6. æ¸…ç†ç¯å¢ƒ
docker-compose -f docker-compose.test.yml down -v
```

---

## âš ï¸ æ”¹åŠ¨è¯„ä»·ä½“ç³»

### æ”¹åŠ¨å‰æ£€æŸ¥æ¸…å•

åœ¨ä¿®æ”¹ä»£ç å‰ï¼Œç¡®è®¤ï¼š
- [ ] ç†è§£è¦ä¿®æ”¹çš„åŠŸèƒ½
- [ ] æŸ¥çœ‹ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹
- [ ] äº†è§£å¯èƒ½çš„å½±å“é¢

### æ”¹åŠ¨åéªŒè¯æµç¨‹

```bash
# 1. è¿è¡Œç›¸å…³å•å…ƒæµ‹è¯•
cd station/app
go test ./subserver/ai_box/service/... -v

# 2. è¿è¡Œ API æµ‹è¯•
bash qa/station_api/provider_test.sh

# 3. æ£€æŸ¥è¦†ç›–ç‡æ˜¯å¦ä¸‹é™
make test-coverage

# 4. å¦‚æœæµ‹è¯•å¤±è´¥
# âŒ ä¸è¦ä¿®æ”¹æµ‹è¯•è®©å®ƒé€šè¿‡
# âœ… ä¿®å¤ä»£ç æˆ–æ›´æ–°æµ‹è¯•ï¼ˆå¦‚æœéœ€æ±‚ç¡®å®å˜äº†ï¼‰
```

### å½±å“é¢è¯„ä¼°

| ä¿®æ”¹ç±»å‹ | éœ€è¦è¿è¡Œçš„æµ‹è¯• | å½±å“é¢ |
|---------|--------------|--------|
| ä¿®æ”¹ Service æ–¹æ³• | è¯¥ Service çš„æ‰€æœ‰æµ‹è¯• | ä¸­ |
| ä¿®æ”¹ API Handler | è¯¥ API çš„æ‰€æœ‰æµ‹è¯• + é›†æˆæµ‹è¯• | é«˜ |
| ä¿®æ”¹ Proto å®šä¹‰ | æ‰€æœ‰ä½¿ç”¨è¯¥ Proto çš„æµ‹è¯• | é«˜ |
| ä¿®æ”¹å·¥å…·å‡½æ•° | è¯¥å‡½æ•°çš„æµ‹è¯• | ä½ |

---

## ğŸ›¡ï¸ é˜²æ­¢åŠŸèƒ½å¤±æ•ˆ

### é—®é¢˜æ ¹æº

AI æ”¹ä»£ç æ—¶ä¸å…³æ³¨è¿‡å¾€åŠŸèƒ½ï¼Œå¯¼è‡´ï¼š
- ä¿®æ”¹äº†æŸä¸ªå‡½æ•°ï¼Œç ´åäº†ä¾èµ–å®ƒçš„åŠŸèƒ½
- åˆ é™¤äº†æŸä¸ªå­—æ®µï¼Œå¯¼è‡´ç›¸å…³åŠŸèƒ½æŠ¥é”™
- æ”¹å˜äº† API å“åº”æ ¼å¼ï¼Œå‰ç«¯è§£æå¤±è´¥

### è§£å†³æ–¹æ¡ˆ

#### 1. å¼ºåˆ¶æµ‹è¯•é€šè¿‡

**è§„åˆ™**: æ‰€æœ‰æµ‹è¯•å¿…é¡»é€šè¿‡æ‰èƒ½æäº¤ä»£ç 

**å®ç°**: Git Pre-commit Hook
```bash
# .git/hooks/pre-commit
#!/bin/bash
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
make test || {
    echo "âŒ æµ‹è¯•å¤±è´¥ï¼Œè¯·ä¿®å¤åå†æäº¤"
    exit 1
}
```

#### 2. API å¥‘çº¦ä¿æŠ¤

**è§„åˆ™**: API çš„è¾“å…¥è¾“å‡ºæ ¼å¼ä¸èƒ½éšæ„æ”¹å˜

**å®ç°**: API æµ‹è¯•éªŒè¯
```bash
# qa/station_api/provider_test.sh
# éªŒè¯å“åº”æ ¼å¼
response=$(curl -s http://localhost:18080/aibox/provider?id=123)
if ! echo $response | jq -e '.id' > /dev/null; then
    echo "âŒ API å“åº”ç¼ºå°‘ id å­—æ®µ"
    exit 1
fi
```

#### 3. å›å½’æµ‹è¯•

**è§„åˆ™**: æ¯æ¬¡æ”¹åŠ¨åè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

**å®ç°**: CI/CD è‡ªåŠ¨åŒ–
```yaml
# .github/workflows/test.yml
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Run Tests
        run: make test
      - name: Run API Tests
        run: make test-api
```

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç›‘æ§

### å½“å‰çŠ¶æ€

```bash
# æŸ¥çœ‹è¦†ç›–ç‡
make test-coverage

# ç›®æ ‡
- Service å±‚: 80%+
- Handler å±‚: 70%+
- æ ¸å¿ƒä¸šåŠ¡: 90%+
```

### è¦†ç›–ç‡è¶‹åŠ¿

| æ—¥æœŸ | Go è¦†ç›–ç‡ | Dart è¦†ç›–ç‡ | å¤‡æ³¨ |
|------|----------|------------|------|
| 2026-01-07 | - | - | åŸºçº¿å»ºç«‹ |

---

## ğŸ”„ æŒç»­æ”¹è¿›

### æ¯å‘¨æ£€æŸ¥

- [ ] æ‰€æœ‰æµ‹è¯•æ˜¯å¦é€šè¿‡
- [ ] è¦†ç›–ç‡æ˜¯å¦è¾¾æ ‡
- [ ] æ˜¯å¦æœ‰æ–°åŠŸèƒ½ç¼ºå°‘æµ‹è¯•

### æ¯æœˆå›é¡¾

- [ ] æµ‹è¯•ç”¨ä¾‹æ˜¯å¦éœ€è¦æ›´æ–°
- [ ] æ˜¯å¦æœ‰é‡å¤çš„æµ‹è¯•
- [ ] æµ‹è¯•æ‰§è¡Œæ—¶é—´æ˜¯å¦è¿‡é•¿

---

## ğŸ“ æµ‹è¯•ç¼–å†™æŒ‡å—

### å•å…ƒæµ‹è¯•æ¨¡æ¿

```go
// station/app/subserver/ai_box/service/provider_service_test.go
package service

import (
    "context"
    "testing"
    "github.com/stretchr/testify/assert"
)

func TestCreateProvider(t *testing.T) {
    ctx := context.Background()
    
    t.Run("æˆåŠŸåˆ›å»º", func(t *testing.T) {
        // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        req := &model.Provider{
            Name: "Test Provider",
        }
        
        // 2. æ‰§è¡Œæµ‹è¯•
        result, err := CreateProvider(ctx, req)
        
        // 3. éªŒè¯ç»“æœ
        assert.NoError(t, err)
        assert.NotEmpty(t, result.Id)
        assert.Equal(t, "Test Provider", result.Name)
    })
    
    t.Run("å‚æ•°éªŒè¯", func(t *testing.T) {
        req := &model.Provider{Name: ""}
        _, err := CreateProvider(ctx, req)
        assert.Error(t, err)
    })
}
```

### API æµ‹è¯•æ¨¡æ¿

```bash
#!/bin/bash
# qa/station_api/provider_test.sh

BASE_URL="http://localhost:18080"

echo "ğŸ§ª æµ‹è¯• Provider API"

# 1. åˆ›å»º
echo "1. åˆ›å»º Provider..."
response=$(curl -s -X POST "$BASE_URL/aibox/provider" \
  -H "Content-Type: application/json" \
  -d '{"name": "Test Provider"}')

id=$(echo $response | jq -r '.id')
if [ -z "$id" ]; then
    echo "âŒ åˆ›å»ºå¤±è´¥"
    exit 1
fi
echo "âœ… åˆ›å»ºæˆåŠŸ: $id"

# 2. æŸ¥è¯¢
echo "2. æŸ¥è¯¢ Provider..."
response=$(curl -s "$BASE_URL/aibox/provider?id=$id")
name=$(echo $response | jq -r '.name')
if [ "$name" != "Test Provider" ]; then
    echo "âŒ æŸ¥è¯¢å¤±è´¥"
    exit 1
fi
echo "âœ… æŸ¥è¯¢æˆåŠŸ"

# 3. æ¸…ç†
curl -s -X DELETE "$BASE_URL/aibox/provider" \
  -H "Content-Type: application/json" \
  -d "{\"id\": \"$id\"}"

echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡"
```

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2 å‘¨ï¼‰

- [ ] å»ºç«‹åŸºç¡€æµ‹è¯•æ¡†æ¶
- [ ] æ ¸å¿ƒ API æœ‰æµ‹è¯•è¦†ç›–
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 60%+

### ä¸­æœŸç›®æ ‡ï¼ˆ1 ä¸ªæœˆï¼‰

- [ ] æ‰€æœ‰ Service å±‚æœ‰å•å…ƒæµ‹è¯•
- [ ] æ‰€æœ‰ API æœ‰é›†æˆæµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 80%+
- [ ] CI/CD è‡ªåŠ¨è¿è¡Œæµ‹è¯•

### é•¿æœŸç›®æ ‡ï¼ˆæŒç»­ï¼‰

- [ ] æµ‹è¯•è¦†ç›–ç‡ä¿æŒ 80%+
- [ ] æ–°åŠŸèƒ½å¿…é¡»æœ‰æµ‹è¯•
- [ ] æµ‹è¯•æ‰§è¡Œæ—¶é—´ < 5 åˆ†é’Ÿ
- [ ] é›¶åŠŸèƒ½å›é€€

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… DO

1. **æ¯æ¬¡æ”¹åŠ¨éƒ½è¿è¡Œæµ‹è¯•**
2. **æµ‹è¯•å¤±è´¥ç«‹å³ä¿®å¤**
3. **æ–°åŠŸèƒ½å¿…é¡»æœ‰æµ‹è¯•**
4. **ä¿æŒæµ‹è¯•ç®€å•æ˜äº†**
5. **å®šæœŸ Review æµ‹è¯•è´¨é‡**

### âŒ DON'T

1. **ä¸è¦è·³è¿‡å¤±è´¥çš„æµ‹è¯•**
2. **ä¸è¦ä¸ºäº†è¦†ç›–ç‡å†™æ— æ„ä¹‰çš„æµ‹è¯•**
3. **ä¸è¦è®©æµ‹è¯•ç›¸äº’ä¾èµ–**
4. **ä¸è¦åœ¨æµ‹è¯•ä¸­ä½¿ç”¨çœŸå®æ•°æ®**
5. **ä¸è¦å¿½ç•¥æµ‹è¯•è­¦å‘Š**

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Station API æµ‹è¯•](station/api_tests/README.md)
- [Client æµ‹è¯•](client/README.md)
- [é¡¹ç›®è§„åˆ™](../.trae/rules/project_rules.md)
- [å®Œæ•´æµ‹è¯•æ–¹æ¡ˆ](../TESTING.zh.md)ï¼ˆå·²åºŸå¼ƒï¼Œå‚è€ƒæœ¬æ–‡æ¡£ï¼‰

---

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æµ‹è¯•è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥æ˜¯å¦æ˜¯ä»£ç é—®é¢˜
3. å‚è€ƒæµ‹è¯•ç¼–å†™æŒ‡å—
4. åœ¨å›¢é˜Ÿä¸­è®¨è®º

---

*è´¨é‡ä¿è¯æ˜¯æŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦å›¢é˜Ÿå…±åŒç»´æŠ¤ï¼*
