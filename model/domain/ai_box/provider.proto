syntax = "proto3";

package peers_touch.model.ai_box.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/peers-labs/peers-touch/station/app/subserver/ai_box/model;model";

// Provider类型映射
enum ProviderType {
  openai = 0;
  ollama = 1;
  deepseek = 2;
  custom = 1001;
}


// =================================================
// 1. Provider (Domain Model)
// 核心领域模型，与数据库结构对齐，是系统内部的权威表示。
// =================================================
message Provider {
  string id = 1;                      // 唯一ID
  string name = 2;                    // 显示名称
  string peers_user_id = 3;           // 关联的用户ID
  int32 sort = 4;                     // 排序
  bool enabled = 5;                   // 是否启用
  string check_model = 6;             // 用于连接检查的模型
  string logo = 7;                    // Logo URL
  string description = 8;             // 描述
  string key_vaults = 9;              // 【敏感】API密钥或其他凭证的安全存储引用
  string source_type = 10;            // 提供商类型 (e.g."custom")
  string settings_json = 11;          // JSON 字符串。连接与环境设置，描述“这个 Provider 是谁、怎么连、用什么协议”。变化频率低，偏向基础配置和端点信息。
  string config_json = 12;            // JSON 字符串。生成参数与请求行为，描述“这次请求怎么生成、用什么采样策略”。变化更频繁，偏向模型调用的动态配置。
  google.protobuf.Timestamp accessed_at = 13;
  google.protobuf.Timestamp created_at = 14;
  google.protobuf.Timestamp updated_at = 15;
}

// =================================================
// 2. ProviderView (View Model)
// 用于UI展示的轻量级模型，仅包含渲染提供商列表或卡片所需的数据。
// =================================================
message ProviderView {
  string id = 1;
  string name = 2;
  string description = 3;
  string logo = 4;
  string source_type = 5;
  bool enabled = 6;
  string display_status = 7; // 用于UI展示的派生状态 (e.g., "Connected", "Needs Config")
}

// =================================================
// 3. ProviderInfo (API Model / DTO)
// 用于客户端-服务端通信，隐藏了敏感信息和内部状态。
// =================================================
message ProviderInfo {
  string id = 1;
  string name = 2;
  string description = 3;
  string logo = 4;
  string source_type = 5;
  bool enabled = 6;
  string schema_json = 7;
}

message CreateProviderRequest {
  string name = 1;
  string description = 2;
  string logo = 3;
  string key_vaults = 4;
  string settings_json = 5;
  string config_json = 6;
}

message CreateProviderResponse {
  Provider provider = 1;
}

message UpdateProviderRequest {
  string id = 1;
  optional string name = 2;
  optional string description = 3;
  optional string logo = 4;
  optional bool enabled = 5;
  optional string key_vaults = 6;
  optional string settings_json = 7;
  optional string config_json = 8;
}

message UpdateProviderResponse {
  Provider provider = 1;
}

message DeleteProviderRequest {
  string id = 1;
}

message DeleteProviderResponse {
  bool success = 1;
}

message GetProviderRequest {
  string id = 1;
}

message GetProviderResponse {
  Provider provider = 1;
}

message ListProvidersRequest {
  int32 page_number = 1;
  int32 page_size = 2;
  bool enabled_only = 3;
}

message ListProvidersResponse {
  repeated Provider providers = 1;
  int64 total = 2;
  int32 page_number = 3;
  int32 page_size = 4;
}

message TestProviderRequest {
  string id = 1;
}

message TestProviderResponse {
  bool ok = 1;
  string message = 2;
}